Molsim
======

# Introduction {#Introduction}
MOLSIM is a modular MOLecular SIMulation software for simulation of all-atom and coarse-grained
model systems with extensive static and dynamic analyses. It can be run in two different **modes**:
generating configurations/trajectory and reading configurations/trajectory. The latter one is useful
for subsequent analyses.

MOLSIM supports molecular dynamics (MD), Monte Carlo (MC), and Brownian dynamics (BD)
simulation **methods**. Simulations can be performed the microcanonical (NVE), canonical (NVT),
isobaric (NPT), and grand canonical (µVT) **ensembles** with a number of different boundary
**conditions** applied. Initial **configurations** can be generated by random, on lattice, or using user-
provided routines, as well as be read from text files or from binary files of previous simulations.

More specifically, several MD integrators are provided and quaternion description is used for rigid-
body rotation. Regarding MC, a large selection of different types of trial displacements is available
and cluster moves are supported being useful for system with strongly interacting particles. The
total number of **time steps**, in case of MD or BD, or **passes** (one attempt to move each particle), in
case of MC, are divided into blocks called **macrosteps**. Complete calculations of averages are done
and written for each macrostep, and grand averages are given after the simulation. For some
quantities fluctuations are also given. The **precision** of grand averages (i) of scalar variables are
calculated by extrapolation of block averages to infinite block length and (ii) of distribution
functions from the spread of macrostep averages. Simulations can easily be restarted after an
interruption or **prolonged**. Binary storage are used for saved positions and velocities, saved
intermediate data, and saved data for subequent analyses for maximal accuary.

MOLSIM is able to handle four types of **objects**. They are **atom**, **particle**, **chain**, and **hierarchical
structure**, and they are related to each other as follows: a hierarchical structure is built up of one or
several chains, a chain of one or several particles and a particle of one or several atoms. Interactions
originate from atoms and particles constitute rigid entities. A particle can, e.g., represent a
molecule, a monomer in a polymer joined by a bonding potential, or a colloidal particle; a chain a
linear polymer; and a hierarchical structure a dendrimer. Identical **objects** belong to the same class
of **object type**. Order numbers are assigned to objects and object types as well as to **pairs of
objects** and to **pairs of object types**. Whenever objects or object types, say A, B, C, appear ordered
as (A, B, C), the order of the corresponding pairs becomes (AA, AB, AC, BB, BC, CC). This
ordering of object and object pairs is important for the assignment of values to input variables.

The **nonbonded** pair potentials, operating between pairs of atoms, can be specified either as (i) a
sum of A*/r**n terms with different prefactors and exponents, or by special routines adapted for
more complicated potentials, including the possibility of user-provided potential routines. The two-
body interactions are calculated through a **neighbor list** technique, and the potentials and forces are
evaluated through **lookup tables**. Different routines are used whether (i) charge, (ii) charge and
dipole, or (ii) charge, dipole, and induced dipole interactions are present. In the last case, atom
charges, atom dipole moments, and anisotropic polarizability tensors are explicitly used in an
efficient prediction method to handle the **many-body polarization**. The long-range charge and
dipolar interactions are handled by **Ewald** summation, including the Smooth Particle Mesh method,
or by a **reaction-field** method.

The **static analysis** comprises energy distribution functions (df), radial and angular distribution
functions, and structure factors. Moreover a large selection of df's describing polarization of dipolar
fluids and, the structure of water are available. Also a range of df's charactering polymer shape,
structure as well as cluster formation analyses are implemented. Finally, excess chemical potential
and potential of mean forces can be evaluated. Implemented **dynamic analyses** are mean square
displacements, time correlation functions of velocities, orientations, angular velocities, forces,
torques, induced dipole moments, and potential energy. It is possible to restrict the static and
dynamic analyses to groups of molecules specified by the user.

It is easy to add **user-provided routines** to  MOLSIM to enhance the capability of it. They comprise
additional (i) nonbonded potentials, (ii) preparations of start configuration, (iii) selections of data to
be dumped, (iv) group divisions, (v) static analyses, and (iv) protocols of exporting coordinates and
other information for later image rendering. The user-provided routines are collected in a special
file and do not belong to the supported software. Existing input variables control the calls of these
routines.

The specification of **input variables** characterizing the model and controlling the calculation is
given in an input file. That makes it easy to make sequential calculations with only minor
differences in the specification. Both names and values of the variables are given in input file using
the Namelist protocol, making it easy to read and prepare input files. Blocks of input data are
collected into separate groups.

**Text books on molecular simulation:**
 * Allen, M. P.; Tildelsley, D. J. 'Computer Simulation of Liquids'; Clarendon Press: Oxford, 1987
(1989 in paperback).
 * Frenkel D. and Smit, B. 'Understanding Molecular Simulation: From Algorithms to Applications';
Academic Press: San Diego, 1996.
 * Rapaport, D. C. 'The Art of Molecular Dynamics Simulation'; Cambridge University Press:
Cambridge, 1995.
 * Field, M. J. 'A practical introduction to the simulation of molecular systems'; Cambridge University
Press: Cambridge, 1999.

# Installation {#Installation}

## Obtaining the Code {#ObtainingtheCode}

There are two possibilities of how to obtain the code. You can either simply download the zip of the code, or clone the whole repository.
### Downloading the Zip
Download the zip from [here](https://github.com/joakimstenhammar/molsim/archive/master.zip) and save it in the directory of your choice. Afterwards, navigate to that directory and extract the source code with
```
unzip <name of the zip file>
```
You might want to rename the directory to some more reasonable name.

### Clone the Molsim repository
Just run
```shell
git clone https://github.com/joakimstenhammar/molsim.git
```
If you [set up your ssh key](https://help.github.com/articles/connecting-to-github-with-ssh/) at [GitHub](https://github.com/) you can run
```shell
git clone git@github.com:joakimstenhammar/molsim.git
```

## Installation of Molsim {#InstallationOfMolsim}

Navigate into the Molsim directroy and run the configure script. This will check some dependencies. Molsim requires FFTW 3.3.4. In can be install automatically within the configure script (Note: This might take some time). The configure script will also ask you for a version name. This version name will be appended to the executables of molsim (use `molsim_ser.ver` instead of `molsim_ser`). Leave it blank for no special version name.
```shell
cd Molsim
./configure.sh
```
The configure script tries to locate the FFTW libary. If you want to customize the path of the libary, modify the `Src/make.fftwpath` file. Additionally it will select which compiler to use. To costumize the compiler which is to be used change the `Src/make.arch` file.

Now go to the Src directory and make Molsim:
```shell
cd Molsim/Src
```
and compile the code with
```
make all
```
Alternatively you can compile only the serial code with `make ser`, only the parallel code with `make par`. You might be able to speed up the compilation, by letting the compilation run in parallel (add the option `-j <number of cores>` to the make call e.g. `make -j 4 all`).

To install Molsim run
```
make install
```
If you want to uninstall Molsim run
```
make uninstall
```

After completion, (i) additional files have been created in the source directory, (ii) a subdirectory  Bin has been created and contains the executables molsim_ser.exe and  molsim_par.exe , and (iii) the files  molsim_ser and  molsim_par  have been
copied from the source directory to `$HOME/bin `.

Note, the environmental variable  PATH has to contain `$HOME/bin ` for the software to function (usually this is handled by the configure script)

The installation of the software is now completed.

You can check the version of molsim by passing either the `-v`, `-V` or `--version` to molsim, like
```shell
molsim_ser --version
```

# Getting Started {#GettingStarted}
This chapter describes how to execute the software.

 –  Create a working directory where input and result files will be residing

This directory will in the following be referred to as the work directory. The location of the work
directory is arbitrary

 –  Copy the input file test.in to the work directory

This input file could, e.g., be retrieved from [www.physchem.lu.se/sm](http://130.235.71.100/). At this moment we will not consider the content and the meaning of the variables in the input file. The input variables are the subject of the next chapter.

 –  Type  'molsim_ser test'

After the execution, the files  test.out and  test.list (among others) should now exist in the working
directory.

The content of the output file  test.out , should be essentially the same as that obtained by execution
trough [www.physchem.lu.se/sm](http://130.235.71.100/). If not, probably some error has occurred in the transfer of the code
or during the installation.

The test calculations are normally short. The results of them are normally not applicable for the
equilibrium situation, but are nevertheless useful for testing the installation.

The parallel version of  MOLSIM is invoked by typing  'molsim_par' instead of  'molsim_ser'.

If during the installation you gave a version name while running the configure script, the version name will be appended to the executables of molsim (`molsim_ser.ver` instead of `molsim_ser`).
